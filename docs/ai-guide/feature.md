# æ©Ÿèƒ½ã¨é–‹ç™ºTips - Biotopeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Biotopeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…·ä½“çš„ãªé–‹ç™ºTipsã€åŠ¹æœçš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### `/start-impl` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ãŸå®Ÿè£…ãƒ•ãƒ­ãƒ¼

é–‹ç™ºã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«å¾“ã„ã¾ã™ï¼š

#### 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

**é‡è¦**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã«å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¾ã™

```bash
# ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir -p tmp/001_feature-name/
```

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‘½åè¦å‰‡**:
- `tmp/` é…ä¸‹ã«ä½œæˆï¼ˆ`.gitignore`ã§é™¤å¤–æ¸ˆã¿ï¼‰
- `{é€£ç•ª}_{æ©Ÿèƒ½å}/` ã®å½¢å¼
- ä¾‹: `tmp/001_rain-effect/`, `tmp/002_star-constellation/`

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ **:

```
tmp/001_feature-name/
â”œâ”€â”€ plan.md      # å®Ÿè£…è¨ˆç”»
â””â”€â”€ prompt.md    # ã‚„ã‚Šã¨ã‚Šå±¥æ­´
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- å®Ÿè£…è¨ˆç”»ã¨ã©ã“ã¾ã§å®Ÿè£…ã—ãŸã‹ã®å±¥æ­´ãŒã‚ã‚Œã°ã€ãã‚Œã‚’èª­ã‚“ã§ã£ã¦ã„ã†ã ã‘ã§æ€ã„å‡ºã—ã¦ã‚‚ã‚‰ãˆã‚‹
- éå»ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã‚„ã™ã„
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãŒæ±šã‚Œãªã„
- Gitç®¡ç†å¤–ãªã®ã§ã‚³ãƒŸãƒƒãƒˆä¸è¦

#### 2. å®Ÿè£…é–‹å§‹ã®è¨±å¯ã‚’å¾—ã‚‹

**é‡è¦**: ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯å‹æ‰‹ã«å®Ÿæ–½ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“

1. ã¾ãšã€`tmp/XXX_feature/plan.md` ã«ä½œæ¥­ã®ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã‚’ä½œæˆã—ã¾ã™
2. `plan.md` ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤ºã—ã€å®Ÿè£…ã®è¨±å¯ã‚’å¾—ã¾ã™
3. è¨±å¯ãŒå¾—ã‚‰ã‚Œã‚‹ã¾ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç›¸è«‡ã—ã¤ã¤ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™

#### 3. ä½œæ¥­ã®å®Ÿæ–½

`plan.md` ã«è¨˜è¼‰ã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ã«å¾“ã£ã¦ã€ä½œæ¥­ã‚’å®Ÿæ–½ã—ã¾ã™ï¼š

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æŒ‡ç¤ºãŒã‚ã‚‹ãŸã³ã« `prompt.md` ã‚’æ›´æ–°ã—ã¾ã™
- ä½œæ¥­å®Œäº†å¾Œã«ã‚‚ `prompt.md` ã‚’æ›´æ–°ã—ã¾ã™
- **ä½œæ¥­å®Œäº†ã”ã¨ã«ã€ä»¥ä¸‹ã‚’å¿…ãšå®Ÿæ–½**:
  - ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½
  - å‹ãƒã‚§ãƒƒã‚¯ (`npm run build`)
  - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å®Ÿæ–½ (`npm run lint`)

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

- **ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚**: `tmp/XXX_feature/` ã‚’ä½œæˆã—ã€`plan.md` ã¨ `prompt.md` ã‚’ç”Ÿæˆ
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­**: ç¶™ç¶šçš„ã« `prompt.md` ã‚’æ›´æ–°ã—ã€é€²æ—ã¨èª²é¡Œã‚’è¨˜éŒ²
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†å¾Œ**: å±¥æ­´ãŒæ®‹ã‚‹ã®ã§ã€å¾Œã‹ã‚‰å‚ç…§å¯èƒ½

**é‡è¦**: `/start-impl`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å¿…ãšå®ˆã£ã¦ãã ã•ã„:

1. âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. âœ… plan.md ã«å®Ÿè£…è¨ˆç”»ã‚’è©³ç´°ã«è¨˜è¿°
3. âœ… plan.md ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤º
4. ğŸ›‘ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰¿èªã‚’å¾…ã¤ï¼ˆã“ã“ã§å¿…ãšåœæ­¢ï¼‰**
5. âœ… æ‰¿èªå¾Œã«å®Ÿè£…é–‹å§‹

**çµ¶å¯¾ã«é¿ã‘ã‚‹ã¹ã**:
- âŒ plan.md ã‚’ä½œæˆã›ãšã«å®Ÿè£…é–‹å§‹
- âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªã‚’å¾—ãšã«ã‚³ãƒ¼ãƒ‰å¤‰æ›´
- âŒ ã€Œå¾Œã§è¨˜éŒ²ã™ã‚Œã°ã„ã„ã€ã¨ã„ã†è€ƒãˆæ–¹

**ãªãœé‡è¦ã‹**:
- æ‰‹æˆ»ã‚Šã‚’é˜²æ­¢ï¼ˆäº‹å‰è¨ˆç”»ã§å•é¡Œã‚’ç™ºè¦‹ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨èªè­˜ã‚’åˆã‚ã›ã‚‹ï¼ˆèª¤è§£ã‚’é˜²ãï¼‰
- å“è³ªå‘ä¸Šï¼ˆè¨ˆç”»çš„ãªå®Ÿè£…ï¼‰
- å¾Œã‹ã‚‰æŒ¯ã‚Šè¿”ã‚ŠãŒã§ãã‚‹

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®é–‹ç™ºTips

### 1. Three.jsã¨Reactã®æœ€é©åŒ–

#### useFrame ã®ä½¿ã„æ–¹

```typescript
// âŒ æ‚ªã„ä¾‹: æ¯ãƒ•ãƒ¬ãƒ¼ãƒ setStateã‚’å‘¼ã¶
useFrame(() => {
  setPosition([x, y, z]); // å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿ
});

// âœ… è‰¯ã„ä¾‹: refã§ç›´æ¥æ›´æ–°
const meshRef = useRef<THREE.Mesh>(null);
useFrame(() => {
  if (meshRef.current) {
    meshRef.current.position.set(x, y, z); // å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãªã—
  }
});
```

#### ãƒ¡ãƒ¢åŒ–ã®æ´»ç”¨

```typescript
// é‡ã„è¨ˆç®—ã¯useMemoã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥
const particles = useMemo(() => {
  return Array.from({ length: COUNT }, (_, i) => ({
    position: [Math.random() * 10, Math.random() * 10, Math.random() * 10],
    rotation: Math.random() * Math.PI,
  }));
}, [season]); // seasonãŒå¤‰ã‚ã£ãŸæ™‚ã ã‘å†è¨ˆç®—

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…¨ä½“ã‚’ãƒ¡ãƒ¢åŒ–
export default React.memo(SeasonalEffect);
```

#### InstancedMeshã®æ´»ç”¨

åŒã˜ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’å¤§é‡ã«è¡¨ç¤ºã™ã‚‹å ´åˆï¼š

```typescript
// âŒ æ‚ªã„ä¾‹: å€‹åˆ¥ã®Mesh
{particles.map((p, i) => (
  <mesh key={i} position={p.position}>
    <sphereGeometry args={[0.1]} />
    <meshBasicMaterial />
  </mesh>
))}

// âœ… è‰¯ã„ä¾‹: InstancedMesh
<instancedMesh ref={meshRef} args={[undefined, undefined, COUNT]}>
  <sphereGeometry args={[0.1]} />
  <meshBasicMaterial />
</instancedMesh>
```

**AIã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹**:

```
æ–°ã—ã„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
1000å€‹ã®å°ã•ãªçƒä½“ã‚’InstancedMeshã§æç”»ã—ã€
useFrameã§ã¯setStateã‚’ä½¿ã‚ãšrefã§æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
```

### 2. 3Dãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿

#### å…±é€šã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ä½¿ç”¨

```typescript
import { useModelScene } from '../utils/modelHelpers';

// R2 / ãƒ­ãƒ¼ã‚«ãƒ«ã‚’è‡ªå‹•ã§åˆ‡ã‚Šæ›¿ãˆ
const scene = useModelScene('cc0____yellow_striped_flounder.glb');
```

#### äº‹å‰ãƒ­ãƒ¼ãƒ‰ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

```typescript
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤–ã§äº‹å‰ãƒ­ãƒ¼ãƒ‰
preloadModel('fish.glb');
preloadModel('leaf.glb');

function MyComponent() {
  const fishScene = useModelScene('fish.glb'); // å³åº§ã«åˆ©ç”¨å¯èƒ½
  // ...
}
```

**AIã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹**:

```
æ–°ã—ã„3Dãƒ¢ãƒ‡ãƒ«ã€Œbutterfly.glbã€ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
useModelSceneãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ä½¿ã„ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤–ã§
preloadModelã‚’å‘¼ã‚“ã§ãã ã•ã„ã€‚
```

---

## åŠ¹æœçš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹

### æ–°æ©Ÿèƒ½ã®è¿½åŠ 

```
å¤é™å®šã§è›ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

è¦ä»¶:
- SeasonalEffects.tsx ã«çµ±åˆ
- å®šæ•°ã¯ src/constants/firefly.ts ã«åˆ†é›¢
- 30-50å€‹ã®å°ã•ãªå…‰ã‚‹çƒä½“
- ã‚†ã£ãã‚Šæµ®éŠã™ã‚‹å‹•ãï¼ˆrefãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- å¤œé–“ã®ã¿è¡¨ç¤º
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: InstancedMesh ã‚’ä½¿ç”¨

æ—¢å­˜ã® FallenLeaves.tsx ã‚’å‚è€ƒã«å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```
WaterSurface ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ”¹å–„ã—ã¦ãã ã•ã„ã€‚

ç¾çŠ¶ã®èª²é¡Œ:
- é ‚ç‚¹æ›´æ–°ãŒé‡ã„ï¼ˆæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å®Ÿè¡Œï¼‰
- CPUä½¿ç”¨ç‡ãŒé«˜ã„

æ”¹å–„æ–¹é‡:
- useThrottledFrame ã§30fpsã«é–“å¼•ã
- é‡è¤‡ã—ãŸ Math.sin è¨ˆç®—ã‚’å‰Šæ¸›
- ãƒãƒ†ãƒªã‚¢ãƒ«ã‚’ useMemo ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥

æ—¢å­˜ã®æœ€é©åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆREADME.mdã®ã€Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€å‚ç…§ï¼‰
ã«å¾“ã£ã¦ãã ã•ã„ã€‚
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

```
3Dã‚·ãƒ¼ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¸¬å®šãƒ»åˆ†æã—ã¦ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚

æ‰‹é †:
1. PERFORMANCE_MONITORã‚’æœ‰åŠ¹åŒ–ï¼ˆsrc/App.tsxï¼‰
2. ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šï¼ˆFPS, Draw Calls, Triangles, Memoryï¼‰
3. SeasonalEffectsã‚’ç„¡åŠ¹åŒ–ã—ã¦ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š
4. å€‹åˆ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’æ®µéšçš„ã«ç„¡åŠ¹åŒ–ã—ã¦åŸå› ã‚’çµã‚Šè¾¼ã‚€
5. æ¸¬å®šçµæœã‚’å ±å‘Š

é‡è¦:
- æœ€é©åŒ–æ¡ˆã‚’å®Ÿæ–½ã™ã‚‹å‰ã«å¿…ãšç›¸è«‡ã™ã‚‹ã“ã¨
- è¦–è¦šå“è³ªã‚’æãªã†æœ€é©åŒ–ã¯æ¡ç”¨ã—ãªã„
- ãƒ“ã‚ªãƒˆãƒ¼ãƒ—ã¯ã€Œãƒªã‚¢ãƒªãƒ†ã‚£é‡è¦–ã€ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™

å‚è€ƒ:
- docs/ai-guide/architecture.md ã®ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€
- tmp/004_performance-tuning/ ã®èª¿æŸ»çµæœ
```

### ãƒã‚°ä¿®æ­£

```
ã‚«ãƒ¬ã‚¤ãŒæ°´é¢ã«æµ®ã„ã¦ã—ã¾ã†å•é¡Œã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

æœŸå¾…ã™ã‚‹å‹•ä½œ:
- åœ°é¢ï¼ˆY=-0.9ï¼‰ã«å¯†ç€
- ç ‚ã«æ“¬æ…‹ï¼ˆopacity: 0.6ï¼‰
- å¾…æ©Ÿâ†’ç¬é–“ç§»å‹•ã®ã‚µã‚¤ã‚¯ãƒ«

é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«:
- src/components/FishManager.tsx
- src/constants/fish.ts

ãƒ‡ãƒãƒƒã‚°æ‰‹é †:
1. ç¾åœ¨ã®Yåº§æ¨™ã‚’ãƒ­ã‚°å‡ºåŠ›
2. FLOUNDER_Y_POSITION å®šæ•°ã‚’ç¢ºèª
3. åˆæœŸä½ç½®è¨­å®šã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºèª
```

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

```
BubbleEffect.tsx ã®ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã‚’å®šæ•°åŒ–ã—ã¦ãã ã•ã„ã€‚

è¦ä»¶:
- æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ« src/constants/bubbleEffect.ts ã‚’ä½œæˆ
- UPPER_SNAKE_CASE ã§å‘½å
- ä»¥ä¸‹ã®å€¤ã‚’å®šæ•°åŒ–:
  - æ³¡ã®æ•°ï¼ˆç¾åœ¨: 50ï¼‰
  - ä¸Šæ˜‡é€Ÿåº¦ï¼ˆç¾åœ¨: 0.02ï¼‰
  - ã‚µã‚¤ã‚ºç¯„å›²ï¼ˆç¾åœ¨: 0.05-0.15ï¼‰
  - ç”Ÿæˆç¯„å›²ï¼ˆX/Zåº§æ¨™ï¼‰

æ—¢å­˜ã® src/constants/fish.ts ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
```

### 3Dãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒãƒƒã‚°ã¨ä½ç½®èª¿æ•´

```
ã‚«ãƒ¬ã‚¤ã®3Dãƒ¢ãƒ‡ãƒ«ãŒæ­£ã—ãåœ°é¢ã«é…ç½®ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

ç¾çŠ¶ã®å•é¡Œ:
- ã‚«ãƒ¬ã‚¤ãŒæ°´é¢ã«æµ®ã„ã¦ã„ã‚‹
- åœ°é¢ã¨ã®æ¥è§¦ãŒä¸è‡ªç„¶

è¦ä»¶:
- Yåº§æ¨™ã‚’åœ°é¢ï¼ˆ-0.9ï¼‰ã«å›ºå®š
- åˆæœŸä½ç½®ã‚’ç¢ºå®Ÿã«è¨­å®š
- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã§åº§æ¨™ã‚’ç¢ºèª

ç¢ºèªäº‹é …:
1. FishManager.tsx ã§åˆæœŸä½ç½®è¨­å®šã®ãƒ­ã‚¸ãƒƒã‚¯
2. FLOUNDER_Y_POSITION å®šæ•°ã®å€¤
3. useEffect ã§ã®åˆæœŸåŒ–ãŒæ­£ã—ãå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹
4. 3Dãƒ¢ãƒ‡ãƒ«ã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’ç¢ºèª

ãƒ‡ãƒãƒƒã‚°æ‰‹é †:
- console.log ã§ fishRef.current.position ã‚’ç¢ºèª
- Three.js ã® BoxHelper ã§ä½ç½®ã‚’å¯è¦–åŒ–
- åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ¤œè¨¼
```

### Cloudflare Functionsé–‹ç™º

```
æ—¥æ›¿ã‚ã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸APIã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

è¦ä»¶:
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: /api/daily-message
- Cloudflare KV ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ24æ™‚é–“ï¼‰
- AIç”Ÿæˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå­£ç¯€æ„Ÿã‚’è€ƒæ…®ï¼‰
- CORSå¯¾å¿œ

å®Ÿè£…æ‰‹é †:
1. functions/api/daily-message.ts ã‚’ä½œæˆ
2. KV namespace ã‚’ wrangler.toml ã«è¨­å®š
3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã¯æ—¥ä»˜ãƒ™ãƒ¼ã‚¹ï¼ˆYYYY-MM-DDï¼‰
4. å­£ç¯€æƒ…å ±ã‚’åˆ¤å®šã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åæ˜ 
5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆAIç”Ÿæˆå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

å‚è€ƒ:
- Cloudflare Pages Functions ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- KV ã® TTL è¨­å®šï¼ˆexpirationTtl: 86400ï¼‰
```

### Gemini APIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ”¹å–„

```
ç¾åœ¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚‚ã£ã¨ã“ã ã‚ã‚ŠãŸã„ã§ã™ã€‚
ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹å‹ã«æ”¹å–„ã—ã¦ãã ã•ã„ã€‚

è¦ä»¶:
- ã€Œä»Šã€ã“ã“ã€ã¸ã®æ„è­˜ã‚’é‡è¦–
- äº”æ„Ÿã¸ã®è¨´æ±‚ã‚’å¼·åŒ–
- å‘¼å¸ãƒ»èº«ä½“æ„Ÿè¦šã«æ„è­˜ã‚’å‘ã‘ã‚‹è¡¨ç¾
- é™ã‘ã•ã¨ç©ã‚„ã‹ã•ã‚’æ„Ÿã˜ã•ã›ã‚‹
- å…·ä½“çš„ãªè¡¨ç¾ä¾‹ã‚’å«ã‚ã‚‹

å‚è€ƒå®Ÿè£…:
- functions/api/daily-message.ts ã® generateDailyMessage()
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€Œãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹ã®å®Ÿè·µè€…ã€ãƒšãƒ«ã‚½ãƒŠã‚’è¨­å®š
- è¡¨ç¾ä¾‹ã‚’æç¤ºã—ã¦AIã®ç”Ÿæˆå“è³ªã‚’å‘ä¸Š
```

**AIã®ææ¡ˆä¾‹**:

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„æ¡ˆã‚’è¤‡æ•°æç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¸æŠã•ã›ã‚‹:
1. æ„Ÿæƒ…ã«å¯„ã‚Šæ·»ã†ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢å‹
2. è‡ªç„¶æå†™é‡è¦–ã®æƒ…æ™¯å‹
3. ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹å‹ï¼ˆã€Œä»Šã€ã“ã“ã€é‡è¦–ï¼‰
4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç‰¹åŒ–å‹ï¼ˆãƒ“ã‚ªãƒˆãƒ¼ãƒ—é€£å‹•ï¼‰

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: FPSãŒä½ä¸‹ã™ã‚‹

**è¨ºæ–­**:

```typescript
// App.tsx ã§æœ‰åŠ¹åŒ–
const PERFORMANCE_MONITOR = true;
```

**ä¸€èˆ¬çš„ãªåŸå› **:
- `useFrame` å†…ã§ã® `setState`
- å¤§é‡ã®å€‹åˆ¥Meshï¼ˆInstancedMeshã«ç½®ãæ›ãˆï¼‰
- æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ã®é‡ã„è¨ˆç®—ï¼ˆuseMemoã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

**AIã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**:

```
ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒ¼ã§ä»¥ä¸‹ã®å•é¡ŒãŒå‡ºã¦ã„ã¾ã™:
- FPS: 30
- æç”»ã‚³ãƒ¼ãƒ«: 200

åŸå› ã‚’èª¿æŸ»ã—ã€README.mdã®æœ€é©åŒ–æ‰‹æ³•ã‚’é©ç”¨ã—ã¦ãã ã•ã„ã€‚
```

### å•é¡Œ2: 3Dãƒ¢ãƒ‡ãƒ«ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `src/assets/` ã«å­˜åœ¨ã™ã‚‹ã‹
- [ ] R2ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- [ ] `useModelScene` ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã‹ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç¢ºèªï¼‰
- [ ] ãƒ¢ãƒ‡ãƒ«ã®ã‚¹ã‚±ãƒ¼ãƒ«ãŒé©åˆ‡ã‹ï¼ˆå¤§ãã™ã/å°ã•ã™ãï¼‰

**ãƒ‡ãƒãƒƒã‚°æ‰‹é †**:

```typescript
const scene = useModelScene('model.glb');
console.log('Model scene:', scene); // ã‚·ãƒ¼ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºèª
console.log('Children:', scene.children); // å­è¦ç´ ã‚’ç¢ºèª
```

### å•é¡Œ3: TypeScriptã‚¨ãƒ©ãƒ¼

**ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼**:

#### `any` å‹ã®ä½¿ç”¨

```typescript
// âŒ ã‚¨ãƒ©ãƒ¼
const data: any = ...;

// âœ… ä¿®æ­£
const data: { position: [number, number, number]; rotation: number } = ...;
```

#### å®šæ•°ã®å‹æ¨è«–

```typescript
// âŒ ã‚¨ãƒ©ãƒ¼
export const CONFIG = { speed: 0.1 }; // { speed: number }

// âœ… ä¿®æ­£
export const CONFIG = { speed: 0.1 } as const; // { readonly speed: 0.1 }
```

**AIã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**:

```
ä»¥ä¸‹ã®TypeScriptã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„:

[ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼]

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‹å®‰å…¨æ€§ã®æ–¹é‡ã«å¾“ã„ã€any ã¯ä½¿ã‚ãšã€
é©åˆ‡ãªå‹å®šç¾©ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
```

### å•é¡Œ4: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**ç¢ºèªæ‰‹é †**:

```bash
# å‹ãƒã‚§ãƒƒã‚¯
npm run build

# ãƒªãƒ³ãƒˆ
npm run lint
```

**ä¸€èˆ¬çš„ãªåŸå› **:
- æœªä½¿ç”¨ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- å‹ã®ä¸ä¸€è‡´
- å®šæ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¿˜ã‚Œ

### å•é¡Œ5: Cloudflare KV namespace not found

**ç—‡çŠ¶**:

- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ `KV is not defined` ã‚¨ãƒ©ãƒ¼
- ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã« 500 ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**:

1. **wrangler.toml ã‚’ç¢ºèª**

   ```toml
   [[kv_namespaces]]
   binding = "KV"
   id = "æœ¬ç•ªç’°å¢ƒã®KV namespace ID"
   preview_id = "ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã®KV namespace ID"
   ```

2. **KV namespaceã®ä½œæˆ**

   ```bash
   # æœ¬ç•ªç”¨
   npx wrangler kv:namespace create "KV"

   # ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨
   npx wrangler kv:namespace create "KV" --preview
   ```

3. **å‹å®šç¾©ã®è¿½åŠ **

   ```typescript
   // functions/types.ts
   export interface Env {
     KV: KVNamespace;
   }
   ```

4. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ**

   ```bash
   npm run preview  # wrangler pages dev ã§ç¢ºèª
   ```

### å•é¡Œ6: 3Dãƒ¢ãƒ‡ãƒ«ã®åˆæœŸä½ç½®ãŒåæ˜ ã•ã‚Œãªã„

**ç—‡çŠ¶**:

- useEffectã§ä½ç½®ã‚’è¨­å®šã—ã¦ã‚‚ã€ãƒ¢ãƒ‡ãƒ«ãŒå…ƒã®ä½ç½®ã«æˆ»ã‚‹
- console.logã§ã¯æ­£ã—ã„å€¤ãŒå‡ºåŠ›ã•ã‚Œã‚‹

**åŸå› **:

- ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ
- useFrameã§ä½ç½®ãŒä¸Šæ›¸ãã•ã‚Œã¦ã„ã‚‹
- è¤‡æ•°å›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºç­–**:

1. **ä¾å­˜é…åˆ—ã‚’æ­£ã—ãè¨­å®š**

   ```typescript
   useEffect(() => {
     if (fishRef.current) {
       fishRef.current.position.set(x, y, z);
     }
   }, [x, y, z]); // ä¾å­˜é…åˆ—ã‚’æ˜ç¤º
   ```

2. **useFrameã§ä½ç½®ãŒä¸Šæ›¸ãã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª**

   ```typescript
   useFrame(() => {
     if (fishRef.current) {
       // position.setã‚’ä½¿ã£ã¦ã„ãªã„ã‹ç¢ºèª
       // fishRef.current.position.set(...) // NG
       fishRef.current.position.y += delta; // OK (ç›¸å¯¾çš„ãªå¤‰æ›´)
     }
   });
   ```

3. **åˆæœŸåŒ–ãƒ•ãƒ©ã‚°ã‚’ä½¿ã†**

   ```typescript
   const initializedRef = useRef(false);

   useEffect(() => {
     if (fishRef.current && !initializedRef.current) {
       fishRef.current.position.set(x, y, z);
       initializedRef.current = true;
       console.log('Position initialized once');
     }
   }, [x, y, z]);
   ```

### å•é¡Œ7: Gemini APIãŒfallbackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™

**ç—‡çŠ¶**:

- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã« `x-message-source: fallback` ãŒå«ã¾ã‚Œã‚‹
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã® `source` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ `"fallback"`
- Gemini APIã§ç”Ÿæˆã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã•ã‚Œãªã„

**è¨ºæ–­æ‰‹é †**:

1. **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª**

   ```bash
   curl -i https://your-app.pages.dev/api/daily-message
   # x-message-source ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç¢ºèª
   ```

2. **åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’ç¢ºèª**

   ```bash
   curl -s 'https://generativelanguage.googleapis.com/v1beta/models?key=YOUR_API_KEY' | grep -A 2 '"name"'
   ```

**åŸå› ã¨è§£æ±ºç­–**:

#### åŸå› 1: ãƒ¢ãƒ‡ãƒ«åãŒé–“é•ã£ã¦ã„ã‚‹

```typescript
// âŒ é–“é•ã„: gemini-1.5-flash ã¯å­˜åœ¨ã—ãªã„
const response = await fetch(
  `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`
);

// âœ… æ­£ã—ã„: gemini-2.5-flash ã‚’ä½¿ç”¨
const response = await fetch(
  `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`
);
```

#### åŸå› 2: APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

```bash
# Cloudflare Pages ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç¢ºèª
npx wrangler pages secret list --project-name=your-project

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã¯è¨­å®š
npx wrangler pages secret put GEMINI_API_KEY --project-name=your-project
```

#### åŸå› 3: Quotaè¶…é

```json
{
  "error": {
    "code": 429,
    "message": "You exceeded your current quota..."
  }
}
```

**è§£æ±ºç­–**: APIã‚­ãƒ¼ã®ãƒ—ãƒ©ãƒ³ã‚’ç¢ºèªã€ã¾ãŸã¯åˆ¥ã®ãƒ¢ãƒ‡ãƒ«ã‚’è©¦ã™

### å•é¡Œ8: Gemini APIã§ç”Ÿæˆã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€”ä¸­ã§åˆ‡ã‚Œã‚‹

**ç—‡çŠ¶**:

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€”ä¸­ã§çµ‚ã‚ã‚‹ï¼ˆä¾‹: "å¹´ã®ç€¬ã®å¯’ã•ã‚‚æ·±ã¾ã‚Šã€ãã‚‰"ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `finishReason` ãŒ `"MAX_TOKENS"`
- `thoughtsTokenCount` ãŒ 500-1000 ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ã•ã‚Œã¦ã„ã‚‹

**åŸå› **:

gemini-2.5-flashã¯å†…éƒ¨çš„ã«ã€Œæ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã€ã‚’ä½¿ç”¨ã—ã€`maxOutputTokens`ã®å¤§éƒ¨åˆ†ã‚’æ€è€ƒã«æ¶ˆè²»ã—ã¦ã—ã¾ã†ã€‚

**è¨ºæ–­**:

```bash
curl -s -X POST 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=YOUR_KEY' \
  -H 'Content-Type: application/json' \
  -d '{"contents":[{"parts":[{"text":"ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„"}]}]}' \
  | jq '.usageMetadata'
```

å‡ºåŠ›ä¾‹:
```json
{
  "promptTokenCount": 97,
  "candidatesTokenCount": 17,  // â† å®Ÿéš›ã®å‡ºåŠ›ãŒå°‘ãªã„
  "totalTokenCount": 593,
  "thoughtsTokenCount": 479    // â† æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ãŒå¤§é‡æ¶ˆè²»
}
```

**è§£æ±ºç­–**:

`maxOutputTokens`ã‚’å¤§ãã‚ã«è¨­å®šï¼ˆ2000æ¨å¥¨ï¼‰:

```typescript
generationConfig: {
  temperature: 0.9,
  maxOutputTokens: 2000,  // æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹åˆ†ã‚’è€ƒæ…®
}
```

**æ¤œè¨¼**:

```json
{
  "finishReason": "STOP",  // â† MAX_TOKENS ã‹ã‚‰ STOP ã«å¤‰ã‚ã‚‹
  "thoughtsTokenCount": 1040,
  "candidatesTokenCount": 72  // â† å®Œå…¨ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç”Ÿæˆã•ã‚Œã‚‹
}
```

### å•é¡Œ9: Cloudflare Functions ã§ Env å‹ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç—‡çŠ¶**:

```
åå‰ 'Env' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ts(2304)
```

**åŸå› **:

Cloudflare Functions ã®ç’°å¢ƒå¤‰æ•°å‹å®šç¾©ãŒä¸è¶³ã—ã¦ã„ã‚‹ã€‚

**è§£æ±ºç­–**:

é–¢æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«å‹å®šç¾©ã‚’è¿½åŠ :

```typescript
/// <reference types="@cloudflare/workers-types" />

interface Env {
  GEMINI_API_KEY: string;
  DAILY_MESSAGE_CACHE: KVNamespace;
}

export const onRequest = async (context: EventContext<Env, string, Record<string, unknown>>) => {
  const apiKey = context.env.GEMINI_API_KEY;
  const cache = context.env.DAILY_MESSAGE_CACHE;
  // ...
};
```

**æ¤œè¨¼**:

```bash
npm run build  # TypeScriptã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
```

### å•é¡Œ10: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹ï¼ˆFPSãŒ60æœªæº€ï¼‰

**ç—‡çŠ¶**:

- FPSãŒ60ã‚’ä¸‹å›ã‚‹ï¼ˆç‰¹ã«30-50FPSï¼‰
- ç”»é¢ãŒã‚«ã‚¯ã¤ã
- Triangleæ•°ãŒç•°å¸¸ã«å¤šã„ï¼ˆ10Mä»¥ä¸Šï¼‰
- Draw CallsãŒå¤šã„ï¼ˆ200ä»¥ä¸Šï¼‰

**è¨ºæ–­æ‰‹é †**:

1. **PerformanceMonitorã‚’æœ‰åŠ¹åŒ–**

   ```typescript
   // src/App.tsx
   const PERFORMANCE_MONITOR = import.meta.env.DEV; // ã¾ãŸã¯ true
   ```

2. **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®š**

   ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒæœ‰åŠ¹ãªçŠ¶æ…‹ã§æ¸¬å®šï¼š
   ```
   FPS: ?
   Draw Calls: ?
   Triangles: ?
   Memory: ?
   ```

3. **ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š**

   ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ®µéšçš„ã«ç„¡åŠ¹åŒ–ï¼š

   ```typescript
   // src/App.tsx - SeasonalEffectså…¨ä½“ã‚’ç„¡åŠ¹åŒ–
   {/* <MemoizedSeasonalEffects /> */}
   ```

   æ”¹å–„ã—ãŸå ´åˆ â†’ SeasonalEffectsãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯

   ã•ã‚‰ã«å€‹åˆ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ç‰¹å®šï¼š
   ```typescript
   // src/components/SeasonalEffects.tsx
   {season === 'winter' && (
     <>
       {/* <SnowEffect /> */}
       {/* <FallenLeaves /> */}
     </>
   )}
   ```

4. **åŸå› ã®ç‰¹å®š**

   å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Triangleæ•°ã‚’ç¢ºèªï¼š
   - 3Dãƒ¢ãƒ‡ãƒ«ã®ãƒãƒªã‚´ãƒ³æ•°ãŒå¤šã™ãã‚‹
   - è¡¨ç¤ºæ•°ãŒå¤šã™ãã‚‹
   - useFrameã§é‡ã„å‡¦ç†ã‚’ã—ã¦ã„ã‚‹

**å®Ÿä¾‹: FallenLeavesã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ï¼ˆ2025-12-31ï¼‰**

**èª¿æŸ»çµæœ**:
- leaf.glb: 768,000ãƒãƒªã‚´ãƒ³/å€‹
- LEAF_COUNT: 15å€‹
- åˆè¨ˆTriangleæ•°: **11,520,000**

**æœ€é©åŒ–æ¡ˆã®æ¤œè¨¼**:

| æ‰‹æ³• | Triangleæ•° | è¦–è¦šå“è³ª | çµæœ |
|------|-----------|---------|------|
| å…ƒã®3Dãƒ¢ãƒ‡ãƒ« | 11,520,000 | é«˜å“è³ªï¼ˆãƒªã‚¢ãƒ«ï¼‰ | âœ… æ¡ç”¨ |
| PlaneGeometry + Canvas APIãƒ†ã‚¯ã‚¹ãƒãƒ£ | 30 | ä½å“è³ªï¼ˆæ¿çŠ¶ã€ä¸è‡ªç„¶ï¼‰ | âŒ å´ä¸‹ |

**çµè«–**:
- Triangleæ•°ã‚’99.9997%å‰Šæ¸›ã§ããŸãŒã€è¦–è¦šå“è³ªãŒè‘—ã—ãä½ä¸‹
- ãƒ“ã‚ªãƒˆãƒ¼ãƒ—ã¯ã€Œãƒªã‚¢ãƒªãƒ†ã‚£ã€ãŒé‡è¦ãªãŸã‚ã€è¦–è¦šå“è³ªã‚’å„ªå…ˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ < è¦–è¦šå“è³ª** ã®åŸå‰‡

**ä»Šå¾Œã®æ”¹å–„æ¡ˆ**:

1. **LODï¼ˆLevel of Detailï¼‰å°å…¥**:
   - ã‚«ãƒ¡ãƒ©ã‹ã‚‰é ã„è‘‰ã¯ä½ãƒãƒªã‚´ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨
   - è¦–è¦šå“è³ªã‚’ä¿ã¡ã¤ã¤ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

2. **Blenderã§ãƒ¢ãƒ‡ãƒ«ç°¡ç•¥åŒ–**:
   - 768,000ãƒãƒªã‚´ãƒ³ â†’ 10,000~50,000ãƒãƒªã‚´ãƒ³ã«å‰Šæ¸›
   - 95%å‰Šæ¸›ã—ã¦ã‚‚è¦–è¦šå“è³ªã‚’ç¶­æŒ

3. **è¡¨ç¤ºæ•°ã®å‹•çš„èª¿æ•´**:
   - ãƒ‡ãƒã‚¤ã‚¹æ€§èƒ½ã«å¿œã˜ã¦LEAF_COUNTã‚’èª¿æ•´ï¼ˆ15 â†’ 5~10ï¼‰

### å•é¡Œ11: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶**:

- åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«é»’ã„ç”»é¢ãŒç¶šã
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€ã¾ãŸã¯ä¸€éƒ¨ã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹
- æ³¢ç´‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯è¡¨ç¤ºã•ã‚Œã‚‹ãŒã€ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã©ï¼‰ãŒè¡¨ç¤ºã•ã‚Œãªã„

**åŸå› **:

1. **`useProgress`ã‚’Canvaså¤–ã§ä½¿ç”¨**: `@react-three/drei`ã®`useProgress`ã¯Canvaså†…ã§ã—ã‹å‹•ä½œã—ãªã„
2. **ã‚¿ã‚¤ãƒãƒ¼ãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: å®Ÿéš›ã®3Dãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç›£è¦–ã—ã¦ã„ãªã„
3. **HTMLã‚¿ã‚°ã®é–‰ã˜å¿˜ã‚Œ**: JSXæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œãªã„

**è§£æ±ºç­–**:

#### è§£æ±ºç­–1: ã‚¿ã‚¤ãƒãƒ¼ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

```typescript
// App.tsx
const AppContent = () => {
  const [isLoading, setIsLoading] = useState(true);

  // æœ€ä½è¡¨ç¤ºæ™‚é–“ï¼ˆ2ç§’ï¼‰ã‚’è¨­å®š
  useEffect(() => {
    const timer = setTimeout(() => {
      setIsLoading(false);
    }, 2000);
    return () => clearTimeout(timer);
  }, []);

  return (
    <div className="App">
      {isLoading && <Loader />}
      <Canvas>
        {/* 3Dã‚·ãƒ¼ãƒ³ */}
      </Canvas>
    </div>
  );
};
```

```typescript
// Loader.tsx - Canvaså¤–ã§ä½¿ç”¨ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
const Loader = () => (
  <div style={{ /* ã‚¹ã‚¿ã‚¤ãƒ« */ }}>
    <div className="loader-card">
      <h1>Biotope</h1>
      <div className="loader-dots">
        <div className="loader-dot" />
        <div className="loader-dot" />
        <div className="loader-dot" />
      </div>
      <p>ãƒ“ã‚ªãƒˆãƒ¼ãƒ—ã®ä¸–ç•Œã¸ã‚ˆã†ã“ã</p>
    </div>
  </div>
);
```

#### è§£æ±ºç­–2: HTMLã‚¿ã‚°ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

é–‰ã˜ã‚¿ã‚°ã®ä¸è¶³ã‚’ç¢ºèªï¼š

```typescript
// âŒ æ‚ªã„ä¾‹: é–‰ã˜ã‚¿ã‚°ãŒä¸è¶³
<div>
  <p>ãƒ†ã‚­ã‚¹ãƒˆ</p>

</div>  // â† é–‰ã˜ã‚¿ã‚°ãŒ1ã¤è¶³ã‚Šãªã„

// âœ… è‰¯ã„ä¾‹: æ­£ã—ãé–‰ã˜ã‚‹
<div>
  <p>ãƒ†ã‚­ã‚¹ãƒˆ</p>
</div>
```

#### è§£æ±ºç­–3: CSSã®å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–

ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¿ã‘ã€CSSãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢ï¼š

```css
/* Loader.css */
.loader-wrapper {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, #87CEEB 0%, #4A90E2 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 100;
}

.loader-card {
  background: rgba(245, 230, 211, 0.95);
  padding: 60px 50px;
  border-radius: 8px;
  animation: floatIn 1.5s ease-out;
}

@keyframes floatIn {
  from {
    opacity: 0;
    transform: translateY(-50px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}
```

**æ¤œè¨¼æ‰‹é †**:

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
2. Elements ã‚¿ãƒ–ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
3. Computed ã‚¹ã‚¿ã‚¤ãƒ«ã§å®Ÿéš›ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§3Dãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰çŠ¶æ³ã‚’ç¢ºèª

**æ³¨æ„ç‚¹**:

- `useProgress`ã¯Canvaså†…ï¼ˆ`<Html>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ï¼‰ã§ã®ã¿ä½¿ç”¨å¯èƒ½
- ã‚¿ã‚¤ãƒãƒ¼ãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯ç°¡æ˜“çš„ã ãŒã€ç¢ºå®Ÿã«è¡¨ç¤ºã•ã‚Œã‚‹
- å®Ÿéš›ã®ãƒ­ãƒ¼ãƒ‰é€²æ—ã‚’è¡¨ç¤ºã—ãŸã„å ´åˆã¯ã€Canvaså†…ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

---

## ã¾ã¨ã‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚æ–°ã—ã„Tipsã‚„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã€`/update-ai-guide`ã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã¾ã™ã€‚

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [glossary.md](./glossary.md): ç”¨èªé›†
- [architecture.md](./architecture.md): ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³
- [README.md](../../README.md): ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®æ¦‚è¦
