# 実装計画: /update-ai-guide コマンド

## 目的

セッションの内容とコミット履歴から、自動的に `docs/ai-guide.md` を更新するカスタムスラッシュコマンドを実装する。

## 背景

1. **セッションコンテキストから変更内容を把握**
   - 実装した機能や修正内容
   - 使用した新しいパターンや設計判断
   - 遭遇した問題と解決策

2. **更新が必要な箇所の特定**
   - 新しい実装パターンが追加された場合
   - 既存の説明が古くなった場合
   - 重要な設計変更があった場合

3. **ai-guideの更新**

## 実装スコープ

### 調査フェーズ

Claude Code のカスタムスラッシュコマンドの実装方法を調査：

1. **ドキュメント確認**
   - Claude Code 公式ドキュメント
   - カスタムコマンドのAPI仕様
   - 設定ファイルの場所

2. **既存実装の参照**
   - プロジェクト内に既存のスラッシュコマンドがあるか確認
   - 設定ファイル（`.claude/`、`.vscode/` など）を探索

### 実装フェーズ

#### オプション1: スクリプトベース実装

もしカスタムスラッシュコマンドが難しい場合は、通常のスクリプトとして実装：

```bash
# scripts/update-ai-guide.sh
```

**処理フロー**:
1. 最新のセッションディレクトリ（`tmp/XXX_*/`）を特定
2. `plan.md` と `prompt.md` を読み込み
3. 最近のコミット履歴を取得（`git log`）
4. 変更されたファイルを分析（`git diff`）
5. ai-guide.md に追加すべき内容を特定
6. ai-guide.md を更新

#### オプション2: Claude Code統合

カスタムスラッシュコマンドとして実装：

**ファイル構成**:
```
.claude/
└── commands/
    └── update-ai-guide.md  # コマンド定義
```

**コマンド定義**:
```markdown
# /update-ai-guide

セッションの内容から ai-guide.md を自動更新

## 手順
1. tmp/ 配下の最新セッションを読み込む
2. 実装で使われた新しいパターンを抽出
3. 問題と解決策を抽出
4. docs/ai-guide.md の適切なセクションに追加
```

### 機能要件

1. **セッション分析**
   - `tmp/` 配下の最新セッションディレクトリを自動検出
   - `plan.md` から実装内容を抽出
   - `prompt.md` から課題・解決策を抽出

2. **コミット履歴分析**
   - セッション開始以降のコミットを取得
   - 変更されたファイルのリストを作成
   - 新しいパターンを検出

3. **ai-guide.md更新**
   - 既存のセクション構造を維持
   - 重複を避ける
   - 適切なマークダウン形式で追加

### 更新対象のセクション

以下のセクションに追加可能：

- **プロジェクト固有の開発Tips**: 新しい定数管理パターン、最適化手法
- **効果的なプロンプト例**: 成功したプロンプトを追加
- **よくある開発パターン**: 新しい実装パターン
- **トラブルシューティング**: 遭遇した問題と解決策

## 技術的詳細

### 入力

- `tmp/XXX_feature/plan.md`: 実装計画
- `tmp/XXX_feature/prompt.md`: やりとり履歴
- `git log`: コミット履歴
- `git diff`: 変更内容

### 出力

- `docs/ai-guide.md`: 更新されたガイド

### 処理ロジック

```
1. 最新セッションを特定
   - ls tmp/ | sort -r | head -1

2. セッション内容を読み込み
   - cat tmp/XXX/plan.md
   - cat tmp/XXX/prompt.md

3. コミット履歴を取得
   - git log --oneline -n 10
   - git diff HEAD~5..HEAD --name-only

4. 新しい知見を抽出（AI処理）
   - 実装で使った新しいパターン
   - 遭遇した問題と解決策
   - 成功したプロンプト

5. ai-guide.md を更新
   - 適切なセクションに追加
   - 重複チェック
   - フォーマット調整
```

## 完了条件

- [ ] カスタムスラッシュコマンドの実装方法を調査完了
- [ ] `/update-ai-guide` コマンドが実装され、動作する
- [ ] セッション内容を正しく分析できる
- [ ] ai-guide.md が適切に更新される
- [ ] 既存の構造を壊さない

## 実装時間見積もり

- 調査: 15分
- 実装: 30分
- テスト: 15分
- **合計**: 約60分

---

**次のステップ**: Claude Code のカスタムコマンド実装方法を調査
