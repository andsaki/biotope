# 実装計画: 日替わりメッセージの改善

## セッション情報

- **セッションID**: 005
- **作成日**: 2026-01-14
- **タスク**: Gemini APIの日替わりメッセージを短く心温まる内容に改善

---

## 背景

### 現状の問題

ユーザーから以下のフィードバックがありました：

> 「これ、なんか長すぎて読めないかも。もっとこころ温まるメッセージが欲しい。1日に少し彩があるような」

**具体的な問題点**:
1. メッセージが長すぎる（200文字以上）
2. 瞑想的で重厚な表現（マインドフルネス型）
3. 読むのに時間がかかる
4. 軽やかさに欠ける

**現在のメッセージ例**:
```
深く息を吸い込むと、1月14日、水曜日の冬の澄んだ空気が肺を満たし、心まで洗われるようです。
ひんやりと頬を撫でる風の感触、耳に響く静寂。足元に目をやれば、霜が降りた葉が冬の柔らかな
日差しを浴びて、静かに煌めきます。遠くに見える木々の枝は、素顔のままの美しさ。思考を手放し、
「今、ここ」の穏やかさに身を委ね、身体の内側から広がる静かな安らぎを感じましょう。
```

---

## 改善方針

### 目標

- **60-80文字以内**（2行程度）の短いメッセージ
- 前向きで軽やかな表現
- 心が温まる、ほっとする言葉選び
- 朝の始まりに彩を添える雰囲気

### 理想的なメッセージ例

```
冬の朝、温かい飲み物で一息つきませんか。小さな幸せが、あなたを待っていますよ。
（45文字）

春の風が背中を押してくれます。今日も一歩ずつ、自分のペースで。
（36文字）
```

---

## 実装内容

### 1. Gemini APIプロンプトの改善

**ファイル**: `functions/api/daily-message.ts`

#### Before（マインドフルネス型）

```typescript
const prompt = `あなたはマインドフルネスの実践者であり詩人です。今日は${dateStr}です。

「今、ここ」に意識を向け、${dateStr}のこの瞬間の美しさを感じるメッセージを書いてください。

【条件】
- 200文字以内
- ${dateStr}の「今この瞬間」に存在する季節の要素を描く
- 呼吸、五感、身体感覚に意識を向ける表現
- 過去や未来ではなく「今」に集中させる
- 静けさ、穏やかさを感じさせる
- です・ます調
- メッセージのみを出力（説明や前置きは不要）

【表現例】
- 「深く息を吸うと、〇〇の香りが...」
- 「足元の〇〇に目を向けると...」
- 「今日の空は...」`;
```

#### After（心温まる励まし型）

```typescript
const prompt = `あなたは優しい言葉で人々を励ます詩人です。今日は${dateStr}です。

朝の始まりに心がほっと温まり、1日に少し彩を添えるような短いメッセージを書いてください。

【条件】
- 60-80文字以内（2行程度）
- ${dateStr}の季節の美しさを優しく描く
- 前向きで軽やかな表現
- 心が温まる、ほっとする言葉選び
- です・ます調
- メッセージのみを出力（説明や前置きは不要）

【良い例】
- 「冬の朝、温かい飲み物で一息つきませんか。小さな幸せが、あなたを待っていますよ。」（45文字）
- 「春の風が背中を押してくれます。今日も一歩ずつ、自分のペースで。」（36文字）
- 「夏の光が窓から差し込む朝。深呼吸して、新しい1日を迎えましょう。」（36文字）

【避けるべき表現】
- 長い描写や説明
- 重厚で瞑想的な表現
- 指示的・説教的な内容`;
```

**変更点**:
- ペルソナ: 「マインドフルネスの実践者」→「優しい言葉で人々を励ます詩人」
- 文字数: 200文字 → 60-80文字（60%削減）
- 表現方針: 瞑想的 → 軽やかで前向き
- 良い例と避けるべき表現を明示

### 2. フォールバックメッセージの改善

**ファイル**: `functions/api/daily-message.ts`

#### Before

```typescript
const FALLBACK_MESSAGES: Record<string, string[]> = {
  冬: [
    '凛とした空気の{date}、温かい湯気に包まれながら心までぬくもりを届けてあげてください。',
    '静かな{date}、小さな灯りをひとつともすように自分を労う言葉をかけましょう。',
    // ...
  ],
};
```

#### After

```typescript
const FALLBACK_MESSAGES: Record<string, string[]> = {
  冬: [
    '{date}、冬の朝は冷たいけれど、温かさも見つかります。ゆっくりと。',
    '{date}の空気、凛として清々しい。温かいものでほっとひと息を。',
    '{date}、白い息も素敵でしょ。小さな幸せを集める1日に。',
    '{date}の朝、温もりを大切に。今日もあなたらしく輝いてください。'
  ],
  春: [
    '{date}、春の風が優しく背中を押してくれます。今日も一歩ずつ。',
    '{date}の光、柔らかな温もりに包まれて。小さな幸せを見つけましょう。',
    '{date}、花のつぼみのように。ゆっくり、あなたのペースで咲いてください。',
    '{date}の朝、新しい芽吹きを感じませんか。今日も素敵な1日を。'
  ],
  夏: [
    '{date}、夏の日差しが応援してくれています。水分補給も忘れずに。',
    '{date}の青空、まっすぐで気持ちいいですね。深呼吸して前へ。',
    '{date}、暑さの中にも小さな風。あなたの笑顔が誰かの涼になります。',
    '{date}の朝、冷たい飲み物でひと息。今日も無理せず、自分らしく。'
  ],
  秋: [
    '{date}、秋の空が澄んでいます。深呼吸して、穏やかな1日を。',
    '{date}の風、少しひんやり。温かい飲み物とともに優しい時間を。',
    '{date}、色づく葉のように。あなたの努力も美しく実っています。',
    '{date}の朝、静かな秋の気配。今日も自分のペースで大丈夫。'
  ],
};
```

**変更点**:
- 各メッセージを30-45文字程度に短縮
- 軽やかで前向きな表現に統一
- 季節感を残しつつシンプルに

### 3. ドキュメントの更新

**ファイル**: `docs/ai-guide/glossary.md`, `docs/ai-guide/feature.md`

#### glossary.md

- 「心温まる励まし型プロンプト」を新規追加
- 「マインドフルネス型プロンプト」を非推奨として残す

#### feature.md

- 「Gemini APIプロンプトの改善」セクションを拡張
- 短いメッセージ生成の具体例を追加
- 良い例と避けるべき表現を明示

---

## 実装手順

### ✅ Step 1: プロンプトの修正

- [x] `functions/api/daily-message.ts` の `generateDailyMessage()` 関数を修正
- [x] ペルソナを「優しい言葉で人々を励ます詩人」に変更
- [x] 文字数制限を60-80文字に変更
- [x] 良い例と避けるべき表現を追加

### ✅ Step 2: フォールバックメッセージの修正

- [x] `FALLBACK_MESSAGES` を全季節分修正
- [x] 各メッセージを30-45文字に短縮
- [x] 軽やかで前向きな表現に統一

### ✅ Step 3: ドキュメントの更新

- [x] `docs/ai-guide/glossary.md` を更新
- [x] `docs/ai-guide/feature.md` を更新

### ⏳ Step 4: テストとデプロイ

- [ ] ローカルで動作確認
- [ ] Cloudflare Pagesにデプロイ
- [ ] 本番環境でメッセージ生成をテスト
- [ ] キャッシュをクリアして新しいメッセージを確認

---

## テスト計画

### ローカルテスト

```bash
# 開発サーバーを起動
npm run dev

# Functions APIをローカルでテスト
npm run preview
```

### 本番テスト

```bash
# デプロイ
git add .
git commit -m "feat: 日替わりメッセージを短く心温まる内容に改善"
git push origin main

# APIエンドポイントをテスト
curl -i https://biotope.pages.dev/api/daily-message

# レスポンスの確認
# - message フィールドが60-80文字以内か
# - 軽やかで前向きな表現になっているか
# - 季節感が適切に反映されているか
```

### 確認項目

- [ ] メッセージが60-80文字以内に収まっているか
- [ ] 心温まる、軽やかな表現になっているか
- [ ] 季節の要素が適切に含まれているか
- [ ] 前向きで励ます内容になっているか
- [ ] フォールバックメッセージも同じトーンになっているか

---

## 期待される効果

### ユーザー体験の改善

1. **読みやすさ向上**: 200文字 → 60-80文字（60%削減）
2. **軽快さ**: 瞑想的な重さから軽やかな励ましへ
3. **共感性**: 誰でも共感できる温かい言葉
4. **朝の彩**: 1日の始まりにほっとする瞬間を提供

### プロジェクトへの貢献

- Biotopeの「心穏やかな体験」コンセプトに合致
- ユーザーの日常に小さな幸せを届ける
- 独自性のある温かいメッセージング

---

## リスクと対策

### リスク1: Gemini APIが長いメッセージを生成する

**対策**:
- プロンプトで「60-80文字以内」を強調
- 良い例（30-45文字）を複数提示
- 「避けるべき表現」を明示

### リスク2: フォールバックメッセージの品質低下

**対策**:
- 短くても季節感と温かさを維持
- 全季節分（16メッセージ）を丁寧に作成
- 実際のメッセージと同じトーンに統一

---

## 次のステップ

1. **デプロイ**: 変更をコミット＆プッシュ
2. **テスト**: 本番環境でメッセージを確認
3. **フィードバック収集**: ユーザーの反応を確認
4. **必要に応じて微調整**: プロンプトやフォールバックメッセージを改善

---

## 参考資料

- `functions/api/daily-message.ts`: メッセージ生成API
- `docs/ai-guide/glossary.md`: プロンプトエンジニアリング用語集
- `docs/ai-guide/feature.md`: 効果的なプロンプト例
